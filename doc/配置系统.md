# é…ç½®ç³»ç»Ÿ - å®Œæ•´ä½¿ç”¨æŒ‡å—

> âš™ï¸ **æ–‡æ¡£ä½ç½®**: `doc/é…ç½®ç³»ç»Ÿ.md`
> 
> **å…³è”æ–‡ä»¶**:
> - `backend/internal/config/config.go` - é…ç½®åŠ è½½ä¸ç®¡ç†
> - `.env` / `.env.example` - ç¯å¢ƒå˜é‡æ–‡ä»¶
> - `backend/cmd/main.go` - é…ç½®åˆå§‹åŒ–å…¥å£

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [é…ç½®ç»“æ„](#é…ç½®ç»“æ„)
3. [é…ç½®åŠ è½½](#é…ç½®åŠ è½½)
4. [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
5. [é…ç½®ä½¿ç”¨](#é…ç½®ä½¿ç”¨)
6. [é…ç½®æœ€ä½³å®è·µ](#é…ç½®æœ€ä½³å®è·µ)

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é…ç½®ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚  .env    â”‚    â”‚  ç¯å¢ƒå˜é‡ â”‚    â”‚  é»˜è®¤å€¼   â”‚                 â”‚
â”‚   â”‚  æ–‡ä»¶    â”‚â—„â”€â”€â–ºâ”‚  OS Envs â”‚â—„â”€â”€â–ºâ”‚ Fallback â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚               â”‚                                        â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                â–¼                                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚        â”‚  InitConfig  â”‚                                         â”‚
â”‚        â”‚   é…ç½®åŠ è½½    â”‚                                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚               â–¼                                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚        â”‚ GlobalConfig â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…¨å±€è®¿é—®                      â”‚
â”‚        â”‚  é…ç½®å¯¹è±¡    â”‚                                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®ä¼˜å…ˆçº§

```
é«˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ä½

ç¯å¢ƒå˜é‡ (os.Getenv) > .env æ–‡ä»¶ > é»˜è®¤å€¼ (fallback)
```

---

## é…ç½®ç»“æ„

### Config ç»“æ„ä½“

**æ–‡ä»¶**: `backend/internal/config/config.go`

```go
type Config struct {
    // åº”ç”¨ä¿¡æ¯
    AppName  string  // åº”ç”¨åç§°
    AppTitle string  // åº”ç”¨æ ‡é¢˜
    AppMode  string  // è¿è¡Œæ¨¡å¼ (separate/embedded)
    
    // æœåŠ¡å™¨
    Port string  // ç›‘å¬ç«¯å£
    
    // æ•°æ®åº“
    DBDriver string  // æ•°æ®åº“é©±åŠ¨
    DBDSN    string  // æ•°æ®åº“è¿æ¥ä¸²
    
    // æéªŒéªŒè¯ç 
    GeetestEnabled bool   // æ˜¯å¦å¯ç”¨
    GeetestID      string // æéªŒID
    GeetestKey     string // æéªŒå¯†é’¥
    
    // JWT
    JWTSecret string // JWTç­¾åå¯†é’¥
    
    // ç®¡ç†å‘˜
    AdminPath string // ç®¡ç†å‘˜è·¯å¾„å‰ç¼€
    
    // CORS
    CorsOrigins string // å…è®¸çš„è·¨åŸŸæº
    
    // Swagger
    EnableSwagger bool // æ˜¯å¦å¯ç”¨Swagger
    
    // å‰ç«¯
    FrontendURL string // å‰ç«¯URL
    
    // SMTP
    SMTPHost        string // SMTPæœåŠ¡å™¨
    SMTPPort        string // SMTPç«¯å£
    SMTPUser        string // SMTPç”¨æˆ·å
    SMTPPass        string // SMTPå¯†ç 
    SMTPSSL         bool   // æ˜¯å¦ä½¿ç”¨SSL
    SystemEmail     string // ç³»ç»Ÿå‘ä»¶é‚®ç®±
    SystemEmailName string // ç³»ç»Ÿå‘ä»¶äººåç§°
}

// å…¨å±€é…ç½®å®ä¾‹
var GlobalConfig *Config
```

---

## é…ç½®åŠ è½½

### åŠ è½½æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯åŠ¨åº”ç”¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ InitConfig  â”‚
â”‚  åˆå§‹åŒ–é…ç½®  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â–º å°è¯•åŠ è½½ JSON æ ¼å¼ .env â”€â”€â–º æˆåŠŸ â”€â”€â–º å®Œæˆ
       â”‚
       â””â”€â”€â–º åŠ è½½æ ‡å‡† .env æ–‡ä»¶
              â”‚
              â”œâ”€â”€â–º è¯»å–ç¯å¢ƒå˜é‡
              â”‚
              â”œâ”€â”€â–º è§£æå¹¶è½¬æ¢ç±»å‹
              â”‚
              â””â”€â”€â–º æ„å»º DSN
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ GlobalConfig â”‚
              â”‚   èµ‹å€¼      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆå§‹åŒ–ä»£ç 

**æ–‡ä»¶**: `backend/internal/config/config.go`

```go
// InitConfig åˆå§‹åŒ–é…ç½®
func InitConfig() {
    // ä¼˜å…ˆå°è¯• JSON æ ¼å¼
    if cfg, ok := loadJSONDotEnv(".env"); ok {
        GlobalConfig = cfg
        return
    }
    
    // å›é€€åˆ°æ ‡å‡† .env æ ¼å¼
    if err := godotenv.Load(); err != nil {
        log.Println("Error loading .env file, using default environment variables")
    }
    
    // æ„å»ºé…ç½®
    GlobalConfig = &Config{
        AppName:  getEnv("APP_NAME", "F.st"),
        AppTitle: getEnv("APP_TITLE", "F.st - Think Fast,Run F.st"),
        AppMode:  getEnv("APP_MODE", "separate"),
        Port:     getEnv("PORT", "8080"),
        DBDriver: getEnv("DB_DRIVER", "mysql"),
        DBDSN:    buildDSN(),
        // ... å…¶ä»–é…ç½®
    }
}
```

### æ”¯æŒçš„é…ç½®æ–‡ä»¶æ ¼å¼

#### æ ¼å¼ 1: æ ‡å‡† KEY=VALUE

```env
# æ•°æ®åº“é…ç½®
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=secret
DB_NAME=fst_platform

# æœåŠ¡å™¨é…ç½®
PORT=8080
APP_NAME=F.st

# JWTé…ç½®
JWT_SECRET=your-secret-key
```

#### æ ¼å¼ 2: JSON æ ¼å¼

```json
{
  "db_host": "127.0.0.1",
  "db_port": "3306",
  "db_user": "root",
  "db_password": "secret",
  "db_name": "fst_platform",
  "port": "8080",
  "jwt_secret": "your-secret-key"
}
```

**æ³¨æ„**: JSON æ ¼å¼å¿…é¡»æ˜¯å¤§æ‹¬å·å¼€å¤´ï¼Œä¸”ä½¿ç”¨ä¸‹åˆ’çº¿å‘½åã€‚

---

## ç¯å¢ƒå˜é‡

### å®Œæ•´ç¯å¢ƒå˜é‡åˆ—è¡¨

#### æ•°æ®åº“é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| DB_HOST | 127.0.0.1 | æ•°æ®åº“ä¸»æœº | localhost |
| DB_PORT | 3306 | æ•°æ®åº“ç«¯å£ | 3306 |
| DB_USER | root | æ•°æ®åº“ç”¨æˆ· | fst_user |
| DB_PASSWORD | - | æ•°æ®åº“å¯†ç  | secret123 |
| DB_NAME | fst_platform | æ•°æ®åº“å | myapp_db |

#### æœåŠ¡å™¨é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| PORT | 8080 | HTTPç›‘å¬ç«¯å£ | 3000 |
| APP_NAME | F.st | åº”ç”¨åç§° | MyApp |
| APP_TITLE | F.st - ... | åº”ç”¨æ ‡é¢˜ | My Application |
| APP_MODE | separate | è¿è¡Œæ¨¡å¼ | embedded |

#### JWT é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| JWT_SECRET | secret | JWTç­¾åå¯†é’¥ | your-256-bit-secret |
| JWT_EXPIRE_HOURS | - | Tokenæœ‰æ•ˆæœŸ | 24 |

#### æéªŒéªŒè¯ç 

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| GEETEST_ENABLED | false | æ˜¯å¦å¯ç”¨ | true |
| GEETEST_ID | - | æéªŒID | 1234567890abcdef |
| GEETEST_KEY | - | æéªŒå¯†é’¥ | abcdef1234567890 |

#### SMTP é‚®ä»¶é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| SMTP_HOST | - | SMTPæœåŠ¡å™¨ | smtp.gmail.com |
| SMTP_PORT | - | SMTPç«¯å£ | 587 |
| SMTP_USERNAME | - | SMTPç”¨æˆ·å | user@gmail.com |
| SMTP_PASSWORD | - | SMTPå¯†ç  | app-password |
| SMTP_SSL_TYPE | - | SSLç±»å‹ | ssl |
| SYSTEM_EMAIL_ADDRESS | - | ç³»ç»Ÿå‘ä»¶é‚®ç®± | noreply@app.com |
| SYSTEM_EMAIL_NAME | - | ç³»ç»Ÿå‘ä»¶äººå | MyApp |

#### å…¶ä»–é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|--------|------|------|
| ADMIN_PATH | /admin | ç®¡ç†å‘˜è·¯å¾„ | /manage |
| CORS_ORIGINS | - | è·¨åŸŸæº | http://localhost:3000 |
| ENABLE_SWAGGER | false | å¯ç”¨Swagger | true |
| FRONTEND_URL | - | å‰ç«¯URL | http://localhost:5173 |

### ç¯å¢ƒå˜é‡æ–‡ä»¶æ¨¡æ¿

**æ–‡ä»¶**: `.env.example`

```env
# ============================================
# åº”ç”¨é…ç½®
# ============================================
APP_NAME=F.st
APP_TITLE=F.st - Think Fast,Run F.st
APP_MODE=separate
PORT=8080

# ============================================
# æ•°æ®åº“é…ç½® (å¿…éœ€)
# ============================================
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=
DB_NAME=fst_platform

# ============================================
# JWT é…ç½® (ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹)
# ============================================
JWT_SECRET=change-this-in-production

# ============================================
# æéªŒéªŒè¯ç  (å¯é€‰)
# ============================================
GEETEST_ENABLED=false
GEETEST_ID=
GEETEST_KEY=

# ============================================
# SMTP é‚®ä»¶é…ç½® (å¯é€‰)
# ============================================
SMTP_HOST=
SMTP_PORT=
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_SSL_TYPE=
SYSTEM_EMAIL_ADDRESS=
SYSTEM_EMAIL_NAME=

# ============================================
# å…¶ä»–é…ç½®
# ============================================
ADMIN_PATH=/admin
CORS_ORIGINS=http://localhost:5173
ENABLE_SWAGGER=true
FRONTEND_URL=http://localhost:5173
```

---

## é…ç½®ä½¿ç”¨

### åŸºæœ¬ä½¿ç”¨

```go
package controllers

import (
    "fst/backend/internal/config"
)

func SomeHandler(c *gin.Context) {
    // è®¿é—®å…¨å±€é…ç½®
    port := config.GlobalConfig.Port
    appName := config.GlobalConfig.AppName
    
    // æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
    if config.GlobalConfig.GeetestEnabled {
        // å¤„ç†éªŒè¯ç 
    }
    
    // ä½¿ç”¨é…ç½®å€¼
    email := utils.EmailMessage{
        To: user.Email,
        Subject: config.GlobalConfig.AppName + " - éªŒè¯ç ",
    }
}
```

### é…ç½®æ£€æŸ¥æ¨¡å¼

```go
// CheckMode æ£€æŸ¥è¿è¡Œæ¨¡å¼
func CheckMode() string {
    return config.GlobalConfig.AppMode
}

// IsDev æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘æ¨¡å¼
func IsDev() bool {
    return config.GlobalConfig.AppMode != "production"
}

// IsProduction æ£€æŸ¥æ˜¯å¦ä¸ºç”Ÿäº§æ¨¡å¼
func IsProduction() bool {
    return config.GlobalConfig.AppMode == "production"
}
```

### åŠ¨æ€é…ç½®ï¼ˆçƒ­æ›´æ–°ï¼‰

```go
package config

import (
    "sync"
    "time"
)

var (
    configMutex sync.RWMutex
    lastReload  time.Time
)

// ReloadConfig é‡æ–°åŠ è½½é…ç½®
func ReloadConfig() error {
    configMutex.Lock()
    defer configMutex.Unlock()
    
    cfg, err := loadConfigFromFile()
    if err != nil {
        return err
    }
    
    GlobalConfig = cfg
    lastReload = time.Now()
    
    return nil
}

// GetConfig çº¿ç¨‹å®‰å…¨åœ°è·å–é…ç½®
func GetConfig() *Config {
    configMutex.RLock()
    defer configMutex.RUnlock()
    return GlobalConfig
}
```

---

## é…ç½®æœ€ä½³å®è·µ

### 1. æ•æ„Ÿä¿¡æ¯å¤„ç†

```go
// âœ… ä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿä¿¡æ¯
dbPassword := getEnv("DB_PASSWORD", "")

// âŒ ä¸è¦ç¡¬ç¼–ç å¯†ç 
dbPassword := "123456"
```

### 2. ä½¿ç”¨é»˜è®¤å€¼

```go
// âœ… æä¾›åˆç†çš„é»˜è®¤å€¼
Port: getEnv("PORT", "8080"),

// âœ… æ•°æ®åº“è¿æ¥é»˜è®¤å€¼
DBHost: getEnv("DB_HOST", "127.0.0.1"),
DBPort: getEnv("DB_PORT", "3306"),
```

### 3. é…ç½®éªŒè¯

```go
func (c *Config) Validate() error {
    // éªŒè¯å¿…éœ€é…ç½®
    if c.JWTSecret == "" || c.JWTSecret == "secret" {
        return fmt.Errorf("JWT_SECRET is required and must not be default value")
    }
    
    // éªŒè¯æ•°æ®åº“é…ç½®
    if c.DBDSN == "" {
        return fmt.Errorf("database DSN is required")
    }
    
    // éªŒè¯ç«¯å£èŒƒå›´
    port, _ := strconv.Atoi(c.Port)
    if port < 1 || port > 65535 {
        return fmt.Errorf("invalid port number: %s", c.Port)
    }
    
    return nil
}

// åœ¨ InitConfig ä¸­è°ƒç”¨
func InitConfig() {
    // ... åŠ è½½é…ç½®
    
    if err := GlobalConfig.Validate(); err != nil {
        log.Fatalf("Config validation failed: %v", err)
    }
}
```

### 4. ç¯å¢ƒåŒºåˆ†

```go
func loadEnvFile() {
    env := os.Getenv("APP_ENV")
    if env == "" {
        env = "development"
    }
    
    envFile := fmt.Sprintf(".env.%s", env)
    
    // å°è¯•åŠ è½½ç¯å¢ƒç‰¹å®šé…ç½®
    if _, err := os.Stat(envFile); err == nil {
        godotenv.Load(envFile)
        log.Printf("Loaded config from %s", envFile)
    } else {
        godotenv.Load(".env")
    }
}
```

### 5. é…ç½®æ–‡æ¡£åŒ–

```go
// Config åº”ç”¨é…ç½®
// 
// æ‰€æœ‰é…ç½®é¡¹éƒ½å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œä¼˜å…ˆçº§ï¼š
// 1. ç¯å¢ƒå˜é‡ (os.Getenv)
// 2. .env æ–‡ä»¶
// 3. é»˜è®¤å€¼
//
// å¿…éœ€é…ç½®:
//   - DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME
//   - JWT_SECRET (ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹)
//
// å¯é€‰é…ç½®:
//   - SMTP_* (é‚®ä»¶åŠŸèƒ½)
//   - GEETEST_* (éªŒè¯ç åŠŸèƒ½)
type Config struct {
    // AppName åº”ç”¨åç§°ï¼Œç”¨äºæ˜¾ç¤ºå’Œé‚®ä»¶
    AppName string
    
    // Port HTTPæœåŠ¡å™¨ç›‘å¬ç«¯å£
    Port string
    
    // ... å…¶ä»–å­—æ®µ
}
```

---

## API å‚è€ƒ

### config/config.go

| å‡½æ•°/å˜é‡ | ç­¾å | è¯´æ˜ |
|-----------|------|------|
| GlobalConfig | `var GlobalConfig *Config` | å…¨å±€é…ç½®å®ä¾‹ |
| InitConfig | `func InitConfig()` | åˆå§‹åŒ–é…ç½® |
| getEnv | `func getEnv(key, fallback string) string` | è·å–ç¯å¢ƒå˜é‡ |
| buildDSN | `func buildDSN() string` | æ„å»ºæ•°æ®åº“DSN |

---

> ğŸ“ **æœ€åæ›´æ–°**: 2026-02-04
> 
> å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒ `backend/internal/config/config.go` æºä»£ç ã€‚
