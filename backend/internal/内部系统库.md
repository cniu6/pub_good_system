# 内部系统库 (Internal) 深度流证

## 简介
Internal 目录包含系统最核心的支撑逻辑，采用 Go Internal 机制限制外部包导入。本层级负责管理数据库连接及配置，严格遵循下划线命名规范。

## 详细子模块流证

### 1. 配置管理 (Config)
负责全系统的参数驱动。
- **配置项定义**:
  - `app_name`: 系统名称。
  - `app_mode`: 运行模式 (`separate` / `integrated`)。
  - `db_driver`: 数据库驱动名。
  - `db_dsn`: 数据库连接字符串（包含 host, port, user, password, db_name）。
  - `jwt_secret`: 令牌密钥。

### 2. 数据库持久化 (DB)
基于 `sqlx` 封装的 MySQL 操作层，负责底层 DDL 维护。
- **命名规范**:
  - **数据库名/表名**: 必须全部小写，使用下划线分隔，严禁使用峰驼命名。
  - **字段名**: 必须全部小写，使用下划线分隔。
- **核心表结构流证**:
  - **users 表**:
    - `id`: 自增主键。
    - `username`: 用户唯一标识。
    - `password`: 加密密码。
    - `is_active`: 账户激活状态。
    - `created_at`, `updated_at`, `deleted_at`: 时间审计字段。
- **关键函数**:
  - `InitDB()`: 初始化数据库池。
  - `Migrate()`: 自动执行 SQL 脚本，创建并维护表结构。

### 3. 中间件 (Middleware)
请求拦截与增强处理。
- **auth_middleware**: 校验 JWT 并注入 `user_id`。
- **admin_only**: 角色权限校验。
- **cors_middleware**: 跨域资源共享配置。

## 数据库启动逻辑
1. 加载环境变量并解析为配置对象。
2. 调用 `sqlx.Connect` 建立数据库连接。
3. 执行 `Migrate()` 函数中的 `CREATE TABLE IF NOT EXISTS` 语句，确保基础表（如 `users`）存在且字段符合下划线命名规范。
