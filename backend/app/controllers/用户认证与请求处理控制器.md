# 用户认证与请求处理控制器 (Controllers) 深度流证

## 简介
控制器层是系统的入口，负责接收 HTTP 请求、解析参数、校验数据完整性、调度业务逻辑并返回标准格式的响应。

## 核心控制器详细流证

### 1. AuthController (认证控制器)
处理所有与身份验证、注册及密码找回相关的请求。
- **结构体定义**: `type AuthController struct{}`
- **主要方法**:
  - `Register(c *gin.Context)`:
    - **功能**: 处理用户注册。
    - **逻辑**: 校验邮箱验证码 -> 验证用户名格式 -> 检查唯一性 -> Bcrypt 加密 -> 存入数据库。
  - `SendRegisterCode(c *gin.Context)`:
    - **功能**: 发送注册验证码。
    - **逻辑**: 生成 6 位随机码 -> 存入内存/缓存 -> 发送 SMTP 邮件（开发模式可直接返回验证码）。
  - `Login(c *gin.Context)`:
    - **功能**: 处理用户登录。
    - **逻辑**: 校验极验 (Geetest) 验证码 (若开启) -> 校验用户名/邮箱与密码 -> 签发 Access & Refresh Token -> 返回用户信息。
  - `UpdateToken(c *gin.Context)`:
    - **功能**: 刷新访问令牌。
    - **逻辑**: 校验刷新令牌有效性 -> 签发新双 Token。
  - `SendResetEmail(c *gin.Context)`:
    - **功能**: 发送密码重置链接。
    - **逻辑**: 校验邮箱是否存在 -> 生成 Token -> 发送带有重置链接的邮件。
  - `ResetPasswordConfirm(c *gin.Context)`:
    - **功能**: 确认并执行密码重置。
    - **逻辑**: 校验 Token -> 更新用户密码。

- **请求模型 (Request Models)**:
  - `RegisterRequest`: `username`, `password`, `email`, `code`。
  - `LoginRequest`: `userName` (或 `username`), `password`。
  - `SendCodeRequest`: `email`, `lang`。
  - `ResetPasswordConfirmRequest`: `email`, `code`, `new_password`。

### 2. SystemController (系统管理控制器)
处理系统管理相关的基础数据请求。
- **主要方法**:
  - `GetUserPage`: 获取用户分页列表。
  - `GetRoleList`: 获取角色列表。
  - `GetDictList`: 获取字典列表。
  - `GetCleanupStatus`: 获取验证码清理任务状态。
    - **功能**: 返回清理任务的运行状态、执行间隔、上次执行时间、下次执行时间。
    - **路由**: `GET /api/v1/system/cleanup-status`（需登录）。
    - **数据来源**: 内存中的 `CleanupStatus`，不产生日志输出。

## 响应规范 (Response Policy)
所有控制器均使用 `fst/backend/utils` 中的 `Success` 和 `Fail` 函数返回统一的 JSON 结构：
- `code`: 业务状态码（200 为成功）。
- `message`: 提示信息。
- `data`: 实际业务数据载荷。

## 开发注意事项
- **逻辑剥离**: 控制器中严禁编写复杂的 SQL 或算法，必须下沉至 `models` 或 `services` 层。
- **安全拦截**: 涉及用户数据的操作必须经过 `AuthMiddleware` 校验。
