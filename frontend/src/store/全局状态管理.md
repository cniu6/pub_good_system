# 全局状态管理 (Store) 深度流证

## 简介
基于 Pinia 管理前端全站状态。采用响应式存储，支持持久化。

## 核心 Store 详细流证

### 1. AuthStore (认证存储)
管理用户登录态、令牌及权限。
- **State**:
  - `userInfo`: 存储登录后返回的 `Api.Login.Info`（包含头像、昵称、角色等）。
  - `token`: 存储当前的 AccessToken。
- **Actions**:
  - `login(userName, password)`: 调用登录 API，成功后执行 `handleLoginInfo`。
  - `handleLoginInfo(data)`: 持久化 Token 和用户信息，初始化路由，并执行重定向。
  - `logout()`: 清除本地缓存，重置路由状态，跳转至登录页。
  - `clearAuthStorage()`: 专门负责清理本地存储中的敏感信息。

### 2. AppStore (应用全局配置)
管理主题、布局及多语言。
- **State**:
  - `lang`: 当前语言 (`zh_CN` / `en_US`)。
  - `theme`: Naive UI 主题覆盖配置。
  - `primaryColor`: 系统主题色（主绿/主蓝等）。
  - `layoutMode`: 布局模式 (`vertical` 垂直 / `horizontal` 水平)。
  - `collapsed`: 侧边栏折叠状态。
  - `loadFlag`: 用于控制页面内容重载的标识。
- **Actions**:
  - `setAppLang(lang)`: 切换语言并同步至本地缓存。
  - `setPrimaryColor(color)`: 动态计算悬浮色和点击色，并更新主题配置。
  - `reloadPage()`: 通过控制 `loadFlag` 实现页面的局部或整体重刷。

### 3. RouteStore (路由存储)
管理动态菜单及路由缓存。
- **State**:
  - `menus`: 用于侧边栏显示的 `MenuOption[]`。
  - `rowRoutes`: 原始路由数据，用于权限计算。
  - `cacheRoutes`: 需要 KeepAlive 的组件名称列表。
- **Actions**:
  - `initAuthRoute()`: 核心逻辑。从后端获取路由配置 -> 转换为 Vue Router 格式并动态添加 -> 生成菜单。
  - `setActiveMenu(key)`: 设置当前高亮显示的菜单项。

### 4. TabStore (标签页存储)
管理多标签导航。
- **State**:
  - `tabs`: 当前打开的标签列表。
  - `pinTabs`: 固定在左侧的标签列表。
  - `currentTabPath`: 当前激活的标签路径。
- **Actions**:
  - `addTab(route)`: 校验 `meta.withoutTab` 属性，满足条件则新增标签。
  - `closeTab(fullPath)`: 关闭标签并根据索引关系自动跳转至相邻标签。
  - `closeOtherTabs / closeLeftTabs / closeRightTabs`: 批量关闭操作。

## 数据持久化策略
- **AuthStore**: 使用 `localStorage` 存储用户信息。
- **AppStore**: 使用 `localStorage` 存储主题配置。
- **TabStore**: 使用 `sessionStorage` 存储当前会话的标签页。
